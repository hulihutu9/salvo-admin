<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "https://raw.githubusercontent.com/rbatis/rbatis/master/rbatis-codegen/mybatis-3-mapper.dtd">
<mapper>
    <select id="get_gen_table_page">
        `select * from gen_table`
        <where>
            1 = 1
            <if test="table_name != '' && table_name != null">
                ` and table_name = #{table_name}`
            </if>
            <if test="table_comment != '' && table_comment != null ">
                ` and table_comment = #{table_comment}`
            </if>
            <if test="begin_time != '' && begin_time != null">
                ` and su.create_time between #{begin_time} and #{end_time}`
            </if>
            ` limit #{page_num},#{page_size}`
        </where>
    </select>
    <select id="get_gen_table_by_id">
        `select * from gen_table`
        <where>
            `table_id = #{table_id}`
        </where>
    </select>
    <select id="get_gen_table_count">
        `select count(*) from gen_table`
        <where>
            1 = 1
            <if test="table_name != '' && table_name != null">
                ` and table_name = #{table_name}`
            </if>
            <if test="table_comment != '' && table_comment != null">
                ` and table_comment = #{table_comment}`
            </if>
            <if test="begin_time != '' && begin_time != null">
                ` and su.create_time between #{begin_time} and #{end_time}`
            </if>
        </where>
    </select>
    <delete id="del_gen_table_by_id">
        `delete from gen_table`
        <where>
            `1 = 1 and table_id in ( ${table_id} )`
        </where>
    </delete>
    <select id="get_gen_table_list">
        `select * from gen_table`
    </select>
    <select id="get_db_table_page">
        `select table_name, table_comment, create_time, update_time from information_schema.tables
        where table_schema = (select database())
        AND table_name NOT LIKE 'qrtz\_%' AND table_name NOT LIKE 'gen\_%'
        AND table_name NOT IN (select table_name from gen_table)`
        <if test="table_name != null && table_name != ''">
            ` AND lower(table_name) like lower(concat('%', #{table_name}, '%'))`
        </if>
        <if test="table_comment != null && table_comment != ''">
            ` AND lower(table_comment) like lower(concat('%', #{table_comment}, '%'))`
        </if>
        ` order by create_time desc limit #{page_num},#{page_size}`
    </select>
    <select id="get_db_table_count">
        `select count(*) from information_schema.tables
        where table_schema = (select database())
        AND table_name NOT LIKE 'qrtz\_%' AND table_name NOT LIKE 'gen\_%'
        AND table_name NOT IN (select table_name from gen_table)`
        <if test="table_name != null && table_name != ''">
            ` AND lower(table_name) like lower(concat('%', #{table_name}, '%'))`
        </if>
        <if test="table_comment != null && table_comment != ''">
            ` AND lower(table_comment) like lower(concat('%', #{table_comment}, '%'))`
        </if>
    </select>
    <select id="get_db_table_by_names">
        `select table_name, table_comment, create_time, update_time from information_schema.tables
        where table_schema = (select database())
        AND table_name NOT LIKE 'qrtz\_%' AND table_name NOT LIKE 'gen\_%'`
        ` AND table_name IN ${names}`
    </select>
    <update id="updateGenTable">
        update gen_table
        <set>
            <if test="tableName != null">table_name = #{tableName},</if>
            <if test="tableComment != null and tableComment != ''">table_comment = #{tableComment},</if>
            <if test="subTableName != null">sub_table_name = #{subTableName},</if>
            <if test="subTableFkName != null">sub_table_fk_name = #{subTableFkName},</if>
            <if test="className != null and className != ''">class_name = #{className},</if>
            <if test="functionAuthor != null and functionAuthor != ''">function_author = #{functionAuthor},</if>
            <if test="genType != null and genType != ''">gen_type = #{genType},</if>
            <if test="genPath != null and genPath != ''">gen_path = #{genPath},</if>
            <if test="tplCategory != null and tplCategory != ''">tpl_category = #{tplCategory},</if>
            <if test="tplWebType != null and tplWebType != ''">tpl_web_type = #{tplWebType},</if>
            <if test="packageName != null and packageName != ''">package_name = #{packageName},</if>
            <if test="moduleName != null and moduleName != ''">module_name = #{moduleName},</if>
            <if test="businessName != null and businessName != ''">business_name = #{businessName},</if>
            <if test="functionName != null and functionName != ''">function_name = #{functionName},</if>
            <if test="options != null and options != ''">options = #{options},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            <if test="remark != null">remark = #{remark},</if>
            update_time = sysdate()
        </set>
        where table_id = #{tableId}
    </update>
    <delete id="delete_gen_table_by_ids">
        delete from gen_table where table_id in
        <foreach collection="array" item="tableId" open="(" separator="," close=")">
            #{tableId}
        </foreach>
    </delete>
</mapper>